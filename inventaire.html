<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventaire Code 39</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body { font-family: sans-serif; padding: 20px; }
  #reader { width: 100%; max-width: 400px; margin-bottom: 20px; }
  ul { list-style: none; padding: 0; }
  li { padding: 5px 0; border-bottom: 1px solid #ccc; font-size: 1.2em; }
  button { padding: 10px 20px; font-size: 1em; margin-top: 10px; }
</style>
</head>
<body>
<h1>Inventaire Code 39</h1>

<div id="reader"></div>
<ul id="liste"></ul>
<button id="export">Exporter en CSV</button>

<script>
const inventaire = [];
const liste = document.getElementById('liste');
const exportBtn = document.getElementById('export');

function ajouterCode(code) {
    code = code.replace(/\*/g, "").trim();
    if(code && !inventaire.includes(code)) {
        inventaire.push(code);
        let li = document.createElement('li');
        li.textContent = code;
        liste.appendChild(li);
    }
}

// Initialiser le scanner
const html5QrcodeScanner = new Html5Qrcode("reader");

html5QrcodeScanner.start(
    { facingMode: "environment" }, // caméra arrière
    {
        fps: 10,    // images par seconde
        qrbox: 250, // zone de scan
        formatsToSupport: ["CODE_39"] // scanner Code 39
    },
    (decodedText, decodedResult) => {
        ajouterCode(decodedText);
    },
    (errorMessage) => {
        // erreurs de scan ignorées
    }
).catch(err => console.error(err));

exportBtn.addEventListener('click', () => {
    if(inventaire.length === 0) return alert("Aucun code à exporter");
    const csv = inventaire.join("\n");
    const blob = new Blob([csv], {type: "text/csv"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "inventaire.csv";
    a.click();
    URL.revokeObjectURL(url);
});
</script>
</body>
</html>
